name: HTML CSS CI Pipeline

# Trigger on git push
on:
  push:
    branches: [ main ]

jobs:
  pipeline-job:
    # Self-hosted runner 
    runs-on: self-hosted
    defaults:
      run:
        shell: bash

    steps:
      # Stage 1: Checkout Code
      - name: Checkout Repository
        uses: actions/checkout@v4

      # Stage 2: Build
      - name: Build Stage
        run: |
          echo "Starting Build Process for HTML/CSS..."
          # checking if html exists 
          if [ -f index.html ]; then
            echo "Build Success: index.html found."
          else
            echo "Build Failed: index.html missing!"
            exit 1
          fi

      # Stage 3: Run Application (Localhost Port 8080) [cite: 16, 32]
      - name: Run Application
        run: |
          echo "Starting application on localhost:8080..."
          # using Python built-in server (nohup)
          nohup python3 -m http.server 8080 > server.log 2>&1 &
          echo "Server launched in background."
          sleep 5 # 5 second wait taake server ready ho jaye

      # Stage 4: Test/Validate (Using curl)
      - name: Validate Application
        run: |
          echo "Testing connectivity..."
          # Curl command se check kar rahe hain ke page load ho raha hai ya nahi
          curl -I http://localhost:8080
          echo "Validation Passed: Application is running on port 8080."
          
      # Clean up (Optional)
      - name: Cleanup
        if: always()
        run: |
          pkill -f "http.server" || echo "Server already stopped"