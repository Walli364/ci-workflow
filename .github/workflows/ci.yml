name: HTML CSS CI Pipeline

# Trigger on git push [cite: 70]
on:
  push:
    branches: [ main ]

jobs:
  pipeline-job:
    # PDF Requirement: Runner must be self-hosted 
    runs-on: self-hosted
    defaults:
      run:
        shell: bash

    steps:
      # Stage 1: Checkout Code [cite: 12]
      - name: Checkout Repository
        uses: actions/checkout@v4

      # Stage 2: Build (HTML ke liye files verify karna kaafi hai) [cite: 13]
      - name: Build Stage
        run: |
          echo "Starting Build Process for HTML/CSS..."
          # Check kar rahe hain ke index.html file majood hai ya nahi
          if [ -f index.html ]; then
            echo "Build Success: index.html found."
          else
            echo "Build Failed: index.html missing!"
            exit 1
          fi

      # Stage 3: Run Application (Localhost Port 8080) [cite: 16, 32]
      - name: Run Application
        run: |
          echo "Starting application on localhost:8080..."
          # Python ka built-in server use kar rahe hain background mein (nohup)
          nohup python3 -m http.server 8080 > server.log 2>&1 &
          echo "Server launched in background."
          sleep 5 # 5 second wait taake server ready ho jaye

      # Stage 4: Test/Validate (Using curl) [cite: 14, 35]
      - name: Validate Application
        run: |
          echo "Testing connectivity..."
          # Curl command se check kar rahe hain ke page load ho raha hai ya nahi
          curl -I http://localhost:8080
          echo "Validation Passed: Application is running on port 8080."
          
      # Clean up (Optional: Server ko stop karna taake port free ho jaye)
      - name: Cleanup
        if: always()
        run: |
          pkill -f "http.server" || echo "Server already stopped"